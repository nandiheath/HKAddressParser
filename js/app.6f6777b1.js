(function(e){function t(t){for(var n,i,o=t[0],l=t[1],c=t[2],d=0,h=[];d<o.length;d++)i=o[d],s[i]&&h.push(s[i][0]),s[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,o=1;o<r.length;o++){var l=r[o];0!==s[l]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},s={app:0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/HKAddressParser/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"16c6":function(e,t,r){"use strict";var n=r("7f29"),s=r.n(n);s.a},"1f46":function(e,t,r){},3593:function(e,t,r){},"3ae2":function(e,t,r){},4268:function(e,t,r){"use strict";var n=r("1f46"),s=r.n(n);s.a},5135:function(e,t,r){"use strict";var n=r("3ae2"),s=r.n(n);s.a},"56d7":function(e,t,r){"use strict";r.r(t);var n=r("2b0e"),s=r("bb71");r("da64");n["a"].use(s["a"],{iconfont:"md"});var a=r("8c4f"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("ArcGISMap",{ref:"topMap"}),r("v-layout",[r("v-form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[r("v-text-field",{attrs:{label:"Address",placeholder:"e.g. 銅鑼灣謝斐道488號",required:""},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}}),r("v-btn",{on:{click:e.submit}},[e._v("\n      Search\n    ")]),e._l(e.results,function(e,t){return r("div",{key:t},[r("SingleMatch",{attrs:{result:e,rank:t}})],1)})],2)],1)],1)},o=[],l=r("775d"),c=r.n(l),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("div",[r("h3",{staticClass:"headline mb-0"},[e._v(e._s(0===e.rank?"BEST MATCH!":"Rank #"+(e.rank+1)))]),r("div",[e._v(e._s(e.fullChineseAddressFromResult(e.result.chi)))]),r("div",{staticClass:"grey--text"},[e._v(e._s(e.result.geo.Latitude+","+e.result.geo.Longitude))])]),r("v-container",{attrs:{"grid-list-md":"","text-xs-left":""}},e._l(e.result.chi,function(t,n,s){return r("v-layout",{key:s,class:(s%2===0?"row-even":"row-odd")+(e.isMatch(n)?" matched":""),attrs:{row:"",wrap:""}},[r("v-flex",{staticClass:"field-title",attrs:{xs4:""}},[e._v(e._s(n))]),r("v-flex",{attrs:{xs8:""}},[e._v(e._s(t))])],1)}))],1),r("br")],1)},d=[];function h(e){switch(e){case 1:return"街名";case 2:return"大廈名/村名";case 3:return"街道名稱";case 0:default:return"?"}}const f=["Region","DcDistrict","VillageName","StreetName","BuildingNoFrom","BuildingNoTo","EstateName","BlockNo","BlockDescriptor","BuildingName","PhaseName"],p=[];function g(e,t){const r="EN"===e?p:f;for(let n=0;n<r.length;n+=1){const e=r[n];if(t.indexOf(e)>=0)return n}return console.error(`unknown field : ${t}`),-1}function m(e){const t=[];for(let r=0;r<e.length;r+=1){const{field:n,value:s}=e[r];"DcDistrict"!==n&&("BuildingNoFrom"!==n?"BuildingNoTo"!==n?t.push(s):(t.push(s),t.push("號")):(t.push(s),r<e.length-1&&"BuildingNoTo"===e[r+1].field?t.push("至"):t.push("號")))}return t.join("")}function v(e){const t=[];for(const r of Object.keys(e))t.push(r);return t.sort((e,t)=>g("CHI",e)-g("CHI",t)),m(t.map(t=>({field:t,value:e[t]})))}var b={levelToString:h,fullChineseAddressFromResult:v},S={props:{rank:Number,result:{status:Object,geo:Object,chi:Object,eng:Object,matches:Array}},data:()=>({}),methods:{levelToString:b.levelToString,fullChineseAddressFromResult:b.fullChineseAddressFromResult,isMatch:function(e){return this.result.matches.indexOf(e)>=0}}},y=S,_=(r("f8bd"),r("2877")),j=r("6544"),k=r.n(j),w=r("b0af"),T=r("12b2"),x=r("a523"),A=r("0e8f"),P=r("a722"),C=Object(_["a"])(y,u,d,!1,null,null,null);C.options.__file="SingleMatch.vue";var D=C.exports;k()(C,{VCard:w["a"],VCardTitle:T["a"],VContainer:x["a"],VFlex:A["a"],VLayout:P["a"]});var M=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"map-area"}})},N=[],O=r("afaa"),L=r.n(O),E=r("a79f"),V="https://js.arcgis.com/3.20/";E["a"].defs("ESRI:102140","+proj=tmerc +lat_0=22.31213333333334 +lon_0=114.1785555555556 +k=1 +x_0=836694.05 +y_0=819069.8 +ellps=intl +units=m +no_defs"),E["a"].defs("EPSG:2326","+proj=tmerc +lat_0=22.31213333333334 +lon_0=114.1785555555556 +k=1 +x_0=836694.05 +y_0=819069.8 +ellps=intl +towgs84=-162.619,-276.959,-161.764,0.067753,-2.24365,-1.15883,-1.09425 +units=m +no_defs"),E["a"].defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs");var B={data:function(){return{}},mounted(){this.createMap()},methods:{createMap:function(){L.a.loadModules(["dojo/dom","esri/tasks/locator","esri/dijit/Search","esri/symbols/PictureMarkerSymbol","esri/InfoTemplate","esri/layers/ArcGISTiledMapServiceLayer","esri/SpatialReference","esri/geometry/Point","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/layers/FeatureLayer","esri/map","esri/dijit/Scalebar","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dijit/form/CheckBox","dojo/_base/json","dojo/domReady!"],{url:V}).then(([e,t,r,n,s,a,i,o,l,c,u,d,h])=>{var f="584b2fa686f14ba283874318b3b8d6b0",p=new a("https://api.hkmapservice.gov.hk/ags/map/basemap/HK80?key="+f,{showAttribution:!0}),g=new a("https://api.hkmapservice.gov.hk/ags/map/label-tc/HK80?key="+f),m=new d("map-area",{center:new o(823100,831200,new i({wkid:102140})),showAttribution:!0,zoom:11,minZoom:10,maxZoom:19});m.addLayer(p),m.addLayer(g),this.map=m})},gotoLatLng:function(e,t){L.a.loadModules(["dojo/dom","esri/tasks/locator","esri/dijit/Search","esri/symbols/PictureMarkerSymbol","esri/InfoTemplate","esri/layers/ArcGISTiledMapServiceLayer","esri/SpatialReference","esri/geometry/Point","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/layers/FeatureLayer","esri/map","esri/dijit/Scalebar","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dijit/form/CheckBox","dojo/_base/json","dojo/domReady!"],{url:V}).then(([r,n,s,a,i,o,l,c])=>{var u=Object(E["a"])("EPSG:4326","EPSG:2326",[t,e]);this.map.centerAndZoom(new c(u[0],u[1],new l({wkid:102140})),19)})}}},R=B,F=(r("16c6"),Object(_["a"])(R,M,N,!1,null,"01c29450",null));F.options.__file="ArcGISMap.vue";var I=F.exports,H={components:{SingleMatch:D,ArcGISMap:I},data:()=>({address:"",count:200,results:[]}),methods:{submit:async function(){this.results=[];const e=`https://www.als.ogcio.gov.hk/lookup?q=${this.address}&n=${this.count}`,t=await fetch(e,{headers:{Accept:"application/json","Accept-Language":"en,zh-Hant","Accept-Encoding":"gzip"}}),r=await t.json();this.results=await c.a.searchResult(this.address,r),await this.$refs.topMap.gotoLatLng(Number(this.results[0].geo.Latitude),Number(this.results[0].geo.Longitude))}}},$=H,z=(r("4268"),r("8336")),G=r("4bd4"),K=r("2677"),W=Object(_["a"])($,i,o,!1,null,null,null);W.options.__file="AddressSearcher.vue";var Y=W.exports;k()(W,{VBtn:z["a"],VContainer:x["a"],VForm:G["a"],VLayout:P["a"],VTextField:K["a"]});var q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-alert",{attrs:{type:"error"},model:{value:e.hasError,callback:function(t){e.hasError=t},expression:"hasError"}},[e._v("\n    "+e._s(this.errorMessage)+"\n  ")]),r("v-form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[r("v-textarea",{attrs:{outline:"",name:"input-7-1",label:"Please input the addresses to search. (Seperated by ',')",value:""},model:{value:e.addressString,callback:function(t){e.addressString=t},expression:"addressString"}}),r("v-btn",{on:{click:e.submit}},[e._v("\n      Search\n    ")]),e.results.length>0&&e.results.length===e.addressesToSearch.length?r("download-excel",{attrs:{data:e.normalizedResults,type:"csv"}},[r("v-btn",[e._v("Download")])],1):e._e(),e.addressesToSearch.length>0?[r("v-progress-linear",{attrs:{"background-color":"lime",color:"success",value:100*e.results.length/e.addressesToSearch.length}}),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.normalizedHeaders,items:e.normalizedResults,"rows-per-page-items":[50,100,500,{text:"$vuetify.dataIterator.rowsPerPageAll",value:-1}]},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(t.item,function(t,n){return r("td",{key:n},[e._v("\n            "+e._s(t)+"\n          ")])})}}])})]:e._e()],2)],1)},U=[],Z=r("71f1"),J=r.n(Z);const Q=200;var X={components:{SingleMatch:D,ArcGISMap:I},data:()=>({addressString:"",addressesToSearch:[],errorMessage:null,count:200,results:[]}),computed:{hasError:function(){return null!==this.errorMessage},normalizedHeaders:function(){const e=this.getUnionedHeaders();return[{text:"Address",value:"address"},{text:"Full Result",value:"full_result"},{text:"Latitude",value:"lat"},{text:"Longitude",value:"lng"},...e.map(e=>({text:e,value:e}))]},normalizedResults:function(){const e=this.getUnionedHeaders(),t=this.results.map((t,r)=>{let n={address:this.addressesToSearch[r],full_address:b.fullChineseAddressFromResult(t[0].chi),lat:t[0].geo.Latitude,long:t[0].geo.Longitude};return e.forEach(e=>{n[e]=t[0].chi[e]?t[0].chi[e]:""}),n});return t}},methods:{getUnionedHeaders:function(){let e=[];return this.results.forEach(t=>{const r=t[0].chi,n=Object.keys(r);e=[...new Set([...e,...n])]}),e},submit:async function(){this.errorMessage=null,this.results=[],0!==this.addressString.length?(this.addressesToSearch=this.addressString.split(","),J.a.eachOfLimit(this.addressesToSearch,5,ee.bind(this),e=>{})):this.errorMessage="No address to search"}}};async function ee(e,t){const r=`https://www.als.ogcio.gov.hk/lookup?q=${e}&n=${Q}`,n=await fetch(r,{headers:{Accept:"application/json","Accept-Language":"en,zh-Hant","Accept-Encoding":"gzip"}}),s=await n.json(),a=await c.a.searchResult(e,s);return this.$set(this.results,t,a),a}var te=X,re=(r("5135"),r("0798")),ne=r("8fea"),se=r("8e36"),ae=r("a844"),ie=Object(_["a"])(te,q,U,!1,null,null,null);ie.options.__file="BatchAddressSearcher.vue";var oe=ie.exports;k()(ie,{VAlert:re["a"],VBtn:z["a"],VContainer:x["a"],VDataTable:ne["a"],VForm:G["a"],VProgressLinear:se["a"],VTextarea:ae["a"]}),n["a"].use(a["a"]);var le=new a["a"]({routes:[{path:"/",name:"search",component:Y},{path:"/batch",name:"search_batch",component:oe}]}),ce=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-toolbar",{attrs:{app:""}},[r("nav",{staticClass:"App__nav"},[r("router-link",{attrs:{to:"/"}},[e._v("Single Search")]),e._v(" |\n    "),r("router-link",{attrs:{to:"/batch"}},[e._v("Batch Search")])],1)]),r("v-content",[r("router-view")],1)],1)},ue=[],de={name:"App",data(){return{}}},he=de,fe=r("7496"),pe=r("549c"),ge=r("71d9"),me=Object(_["a"])(he,ce,ue,!1,null,null,null);me.options.__file="App.vue";var ve=me.exports;k()(me,{VApp:fe["a"],VContent:pe["a"],VToolbar:ge["a"]});var be=r("1bdd");n["a"].config.productionTip=!1,n["a"].component("downloadExcel",be["a"]),new n["a"]({render:e=>e(ve),router:le}).$mount("#app")},"775d":function(e,t,r){const{dcDistrict:n}=r("c9d9");console.log;function s(e){const t=e.replace(/([0-9A-z\-\s]+[樓層]|[0-9A-z號\-\s]+[舖鋪]|地[下庫]|平台).*/g,"");return t}function a(e,t){for(const r in n)if(r===e)return t?n[r].chi:n[r].eng;return t?n.invalid.chi:n.invalid.eng}function i(e,t){const r={};for(const n of Object.keys(e)){let s=e[n];if("object"===typeof s)Object.assign(r,i(s,t));else if("string"===typeof s)if(t&&("StreetName"===n||"VillageName"===n||"EstateName"===n)&&s.indexOf(" ")>=0){const e=s.split(" ");for(let t=0;t<e.length;t++)r[n+(t+1)]=e[t]}else"DcDistrict"===n&&(s=a(s,t)),r[n]=s}return r}function o(e){return e.SuggestedAddress.map(e=>({chi:i(e.Address.PremisesAddress.ChiPremisesAddress,!0),eng:i(e.Address.PremisesAddress.EngPremisesAddress,!1),geo:i(e.Address.PremisesAddress.GeospatialInformation,!1)}))}function l(e,t){const r=t.chi;for(const n of Object.keys(r))if(e===r[n])return{key:n,val:r[n]};return null}function c(e,t){const r=[];let n=0,s=0;while(n<e.length){let a;s=e.length;while(n<s){a=e.substring(n,s);const i=l(a,t);if(null!==i){r.push(i);break}s-=1}s===n&&(r.length>0&&r[r.length-1].key,r.push({key:"?",val:e.substring(n,e.length)})),n+=a.length}return r}function u(e,t){return e.indexOf(t)>=0}function d(e,t){for(const r of t){const t=c(e,r),n={level:-1,charlen:0},s=[];for(const{key:e,val:r}of t)u(e,"StreetName")?(n.level=1,n.charlen+=r.length,s.push("StreetName")):u(e,"BuildingNoFrom")&&1===n.level?(n.level=3,n.charlen+=r.length,s.push("BuildingNoFrom")):u(e,"BuildingName")||u(e,"VillageName")||u(e,"EstateName")?(n.charlen+=r.length,-1===n.level&&(n.level=2),s.push(e.replace(/\d+$/g,""))):u(e,"BlockDescriptor")&&(n.charlen+=r.length,s.push("BlockDescriptor"));r.score=n,r.matches=s}return t=t.sort((e,t)=>{const r=e.score.level!==t.score.level?t.score.level-e.score.level:t.score.charlen-e.score.charlen;return r}),t.slice(0,200)}async function h(e,t){const r=s(e),n=o(t);return d(r,n)}e.exports={searchResult:h}},"7f29":function(e,t,r){},c9d9:function(e,t){const r={invalid:{eng:"Invalid District Name",chi:"無效地區"},CW:{eng:"Central and Western District",chi:"中西區"},EST:{eng:"Eastern District",chi:"東區"},ILD:{eng:"Islands District",chi:"離島區"},KLC:{eng:"Kowloon City District",chi:"九龍城區"},KC:{eng:"Kwai Tsing District",chi:"葵青區"},KT:{eng:"Kwun Tong District",chi:"觀塘區"},NTH:{eng:"North District",chi:"北區"},SK:{eng:"Sai Kung District",chi:"西貢區"},ST:{eng:"Sha Tin Distric",chi:"沙田區"},SSP:{eng:"Sham Shui Po District",chi:"深水埗區"},STH:{eng:"Southern District",chi:"南區"},TP:{eng:"Tai Po District",chi:"大埔區"},TW:{eng:"Tsuen Wan District",chi:"荃灣區"},TM:{eng:"Tuen Mun District",chi:"屯門區"},WC:{eng:"Wan Chai District",chi:"灣仔區"},WTS:{eng:"Wong Tai Sin District",chi:"黃大仙區"},YTM:{eng:"Yau Tsim Mong District",chi:"油尖旺區"},YL:{eng:"Yuen Long District",chi:"元朗區"}};e.exports={dcDistrict:r}},f8bd:function(e,t,r){"use strict";var n=r("3593"),s=r.n(n);s.a}});
//# sourceMappingURL=app.6f6777b1.js.map