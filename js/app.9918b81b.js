(function(e){function t(t){for(var s,i,o=t[0],l=t[1],c=t[2],d=0,h=[];d<o.length;d++)i=o[d],n[i]&&h.push(n[i][0]),n[i]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],s=!0,o=1;o<r.length;o++){var l=r[o];0!==n[l]&&(s=!1)}s&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var s={},n={app:0},a=[];function i(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=s,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/HKAddressParser/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},3593:function(e,t,r){},"3ae2":function(e,t,r){},5135:function(e,t,r){"use strict";var s=r("3ae2"),n=r.n(s);n.a},"56d7":function(e,t,r){"use strict";r.r(t);var s=r("2b0e"),n=r("bb71");r("da64");s["a"].use(n["a"],{iconfont:"md"});var a=r("8c4f"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("ArcGISMap",{ref:"topMap"}),r("v-form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[r("v-text-field",{attrs:{label:"請輸入地址",placeholder:"如：九龍佐敦彌敦道380號","append-icon":"search",required:""},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}}),r("v-btn",{on:{click:e.submit}},[e._v("\n      拆地址\n    ")])],1),r("v-container",{attrs:{fluid:"","grid-list-lg":""}},e._l(e.results,function(e,t){return r("div",{key:t},[r("SingleMatch",{attrs:{result:e,rank:t}})],1)}))],1)},o=[],l=r("775d"),c=r.n(l),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("v-card-text",[r("h3",{staticClass:"headline mb-0"},[e._v(e._s(e.fullChineseAddressFromResult(e.result.chi)))]),r("span",{staticClass:"pt-2"},[e._v(e._s(0===e.rank?"BEST MATCH!":"Rank #"+(e.rank+1)))]),r("v-chip",{attrs:{color:"primary","text-color":"white",disabled:"",small:""}},[e._v(e._s(e.result.score))]),r("br"),r("span",{staticClass:"pt-2 grey--text"},[e._v(e._s(e.result.geo.Latitude+","+e.result.geo.Longitude))])],1),r("v-container",{attrs:{"grid-list-md":"","text-xs-left":""}},e._l(e.result.chi,function(t,s,n){return r("v-layout",{key:n,class:(n%2===0?"row-even":"row-odd")+(e.isMatch(s)?" matched":""),attrs:{row:"",wrap:""}},[r("v-flex",{staticClass:"field-title",attrs:{xs4:""}},[e._v(e._s(s))]),r("v-flex",{attrs:{xs8:""}},[e._v(e._s(t))])],1)}))],1),r("br")],1)},d=[];function h(e){switch(e){case 1:return"街名";case 2:return"大廈名/村名";case 3:return"街道名稱";case 0:default:return"?"}}const f=["Region","DcDistrict","VillageName","StreetName","BuildingNoFrom","BuildingNoTo","EstateName","BlockNo","BlockDescriptor","BuildingName","PhaseName"],p=[];function g(e,t){const r="EN"===e?p:f;for(let s=0;s<r.length;s+=1){const e=r[s];if(t.indexOf(e)>=0)return s}return console.error(`unknown field : ${t}`),-1}function m(e){const t=[];for(let r=0;r<e.length;r+=1){const{field:s,value:n}=e[r];"DcDistrict"!==s&&("BuildingNoFrom"!==s?"BuildingNoTo"!==s?t.push(n):(t.push(n),t.push("號")):(t.push(n),r<e.length-1&&"BuildingNoTo"===e[r+1].field?t.push("至"):t.push("號")))}return t.join("")}function v(e){const t=[];for(const r of Object.keys(e))t.push(r);return t.sort((e,t)=>g("CHI",e)-g("CHI",t)),m(t.map(t=>({field:t,value:e[t]})))}var b={levelToString:h,fullChineseAddressFromResult:v},S={props:{rank:Number,result:{status:Object,geo:Object,chi:Object,eng:Object,matches:Array}},data:()=>({}),methods:{levelToString:b.levelToString,fullChineseAddressFromResult:b.fullChineseAddressFromResult,isMatch:function(e){return this.result.matches.indexOf(e)>=0}}},_=S,y=(r("f8bd"),r("2877")),j=r("6544"),w=r.n(j),k=r("b0af"),T=r("99d9"),x=r("12b2"),A=r("cc20"),C=r("a523"),P=r("0e8f"),D=r("a722"),M=Object(y["a"])(_,u,d,!1,null,null,null);M.options.__file="SingleMatch.vue";var O=M.exports;w()(M,{VCard:k["a"],VCardText:T["a"],VCardTitle:x["a"],VChip:A["a"],VContainer:C["a"],VFlex:P["a"],VLayout:D["a"]});var V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"map-area"}})},N=[],E=r("afaa"),L=r.n(E),B=r("a79f"),R="https://js.arcgis.com/3.20/";B["a"].defs("ESRI:102140","+proj=tmerc +lat_0=22.31213333333334 +lon_0=114.1785555555556 +k=1 +x_0=836694.05 +y_0=819069.8 +ellps=intl +units=m +no_defs"),B["a"].defs("EPSG:2326","+proj=tmerc +lat_0=22.31213333333334 +lon_0=114.1785555555556 +k=1 +x_0=836694.05 +y_0=819069.8 +ellps=intl +towgs84=-162.619,-276.959,-161.764,0.067753,-2.24365,-1.15883,-1.09425 +units=m +no_defs"),B["a"].defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs");var I={data:function(){return{}},mounted(){this.createMap()},methods:{createMap:function(){L.a.loadModules(["dojo/dom","esri/tasks/locator","esri/dijit/Search","esri/symbols/PictureMarkerSymbol","esri/InfoTemplate","esri/layers/ArcGISTiledMapServiceLayer","esri/SpatialReference","esri/geometry/Point","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/layers/FeatureLayer","esri/map","esri/dijit/Scalebar","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dijit/form/CheckBox","dojo/_base/json","dojo/domReady!"],{url:R}).then(([e,t,r,s,n,a,i,o,l,c,u,d,h])=>{var f="584b2fa686f14ba283874318b3b8d6b0",p=new a("https://api.hkmapservice.gov.hk/ags/map/basemap/HK80?key="+f,{showAttribution:!0}),g=new a("https://api.hkmapservice.gov.hk/ags/map/label-tc/HK80?key="+f),m=new d("map-area",{center:new o(823100,831200,new i({wkid:102140})),showAttribution:!0,zoom:11,minZoom:10,maxZoom:19});m.addLayer(p),m.addLayer(g),this.map=m})},gotoLatLng:function(e,t){L.a.loadModules(["dojo/dom","esri/tasks/locator","esri/dijit/Search","esri/symbols/PictureMarkerSymbol","esri/InfoTemplate","esri/layers/ArcGISTiledMapServiceLayer","esri/SpatialReference","esri/geometry/Point","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/layers/FeatureLayer","esri/map","esri/dijit/Scalebar","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dijit/form/CheckBox","dojo/_base/json","dojo/domReady!"],{url:R}).then(([r,s,n,a,i,o,l,c])=>{var u=Object(B["a"])("EPSG:4326","EPSG:2326",[t,e]);this.map.centerAndZoom(new c(u[0],u[1],new l({wkid:102140})),19)})}}},F=I,H=(r("f344"),Object(y["a"])(F,V,N,!1,null,"1a621c3e",null));H.options.__file="ArcGISMap.vue";var $=H.exports,K={components:{SingleMatch:O,ArcGISMap:$},data:()=>({address:"",count:200,results:[]}),methods:{submit:async function(){this.results=[];const e=`https://www.als.ogcio.gov.hk/lookup?q=${this.address}&n=${this.count}`,t=await fetch(e,{headers:{Accept:"application/json","Accept-Language":"en,zh-Hant","Accept-Encoding":"gzip"}}),r=await t.json();this.results=await c.a.searchResult(this.address,r),await this.$refs.topMap.gotoLatLng(Number(this.results[0].geo.Latitude),Number(this.results[0].geo.Longitude))}}},z=K,G=r("8336"),W=r("4bd4"),Y=r("2677"),q=Object(y["a"])(z,i,o,!1,null,null,null);q.options.__file="AddressSearcher.vue";var J=q.exports;w()(q,{VBtn:G["a"],VContainer:C["a"],VForm:W["a"],VTextField:Y["a"]});var U=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-alert",{attrs:{type:"error"},model:{value:e.hasError,callback:function(t){e.hasError=t},expression:"hasError"}},[e._v("\n    "+e._s(this.errorMessage)+"\n  ")]),r("v-form",{ref:"form",staticClass:"form",on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[r("v-textarea",{attrs:{outline:"",name:"input-7-1",label:"請輸入地址（每行一個地址）",value:""},model:{value:e.addressString,callback:function(t){e.addressString=t},expression:"addressString"}}),r("v-btn",{on:{click:e.submit}},[e._v("\n      拆地址\n    ")]),e.results.length>0&&e.results.length===e.addressesToSearch.length?r("download-excel",{attrs:{data:e.normalizedResults,type:"csv"}},[r("v-btn",[e._v("下載 CSV")])],1):e._e(),e.addressesToSearch.length>0?[r("v-progress-linear",{attrs:{"background-color":"lime",color:"success",value:100*e.results.length/e.addressesToSearch.length}}),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.normalizedHeaders,items:e.normalizedResults,"rows-per-page-items":[50,100,500,{text:"$vuetify.dataIterator.rowsPerPageAll",value:-1}]},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(t.item,function(t,s){return r("td",{key:s},[e._v("\n            "+e._s(t)+"\n          ")])})}}])})]:e._e()],2)],1)},Z=[],Q=r("71f1"),X=r.n(Q);const ee=200;var te={components:{SingleMatch:O,ArcGISMap:$},data:()=>({addressString:"",addressesToSearch:[],errorMessage:null,count:200,results:[]}),computed:{hasError:function(){return null!==this.errorMessage},normalizedHeaders:function(){const e=this.getUnionedHeaders();return[{text:"Address",value:"address"},{text:"Full Result",value:"full_result"},{text:"Latitude",value:"lat"},{text:"Longitude",value:"lng"},...e.map(e=>({text:e,value:e}))]},normalizedResults:function(){const e=this.getUnionedHeaders(),t=this.results.map((t,r)=>{let s={address:this.addressesToSearch[r],full_address:b.fullChineseAddressFromResult(t[0].chi),lat:t[0].geo.Latitude,long:t[0].geo.Longitude};return e.forEach(e=>{s[e]=t[0].chi[e]?t[0].chi[e]:""}),s});return t}},methods:{getUnionedHeaders:function(){let e=[];return this.results.forEach(t=>{const r=t[0].chi,s=Object.keys(r);e=[...new Set([...e,...s])]}),e},submit:async function(){this.errorMessage=null,this.results=[],0!==this.addressString.length?(this.addressesToSearch=this.addressString.split("\n"),X.a.eachOfLimit(this.addressesToSearch,5,re.bind(this),e=>{})):this.errorMessage="請輸入地址"}}};async function re(e,t){const r=`https://www.als.ogcio.gov.hk/lookup?q=${e}&n=${ee}`,s=await fetch(r,{headers:{Accept:"application/json","Accept-Language":"en,zh-Hant","Accept-Encoding":"gzip"}}),n=await s.json(),a=await c.a.searchResult(e,n);return this.$set(this.results,t,a),a}var se=te,ne=(r("5135"),r("0798")),ae=r("8fea"),ie=r("8e36"),oe=r("a844"),le=Object(y["a"])(se,U,Z,!1,null,null,null);le.options.__file="BatchAddressSearcher.vue";var ce=le.exports;w()(le,{VAlert:ne["a"],VBtn:G["a"],VContainer:C["a"],VDataTable:ae["a"],VForm:W["a"],VProgressLinear:ie["a"],VTextarea:oe["a"]}),s["a"].use(a["a"]);var ue=new a["a"]({routes:[{path:"/",name:"search",component:J},{path:"/batch",name:"search_batch",component:ce}]}),de=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-toolbar",{attrs:{app:""}},[r("v-toolbar-title",[e._v("香港地址編碼定位器 Hong Kong Address Parser")]),r("v-spacer"),r("v-toolbar-items",{staticClass:"hidden-sm-and-down"},[r("v-btn",{attrs:{flat:"",to:"/"}},[e._v("進階處理")]),r("v-btn",{attrs:{flat:"",to:"/batch"}},[e._v("大量處理")]),r("v-btn",{attrs:{flat:"",href:"https://goo.gl/forms/lDKpoOm7bStvJ2483",target:"_blank"}},[e._v("反映意見")])],1)],1),r("v-content",[r("router-view")],1)],1)},he=[],fe={name:"App",data(){return{}}},pe=fe,ge=r("7496"),me=r("549c"),ve=r("9910"),be=r("71d9"),Se=r("2a7f"),_e=Object(y["a"])(pe,de,he,!1,null,null,null);_e.options.__file="App.vue";var ye=_e.exports;w()(_e,{VApp:ge["a"],VBtn:G["a"],VContent:me["a"],VSpacer:ve["a"],VToolbar:be["a"],VToolbarItems:Se["a"],VToolbarTitle:Se["b"]});var je=r("1bdd");s["a"].config.productionTip=!1,s["a"].component("downloadExcel",je["a"]),new s["a"]({render:e=>e(ye),router:ue}).$mount("#app")},"775d":function(e,t,r){const{dcDistrict:s}=r("c9d9");console.log;function n(e){const t=e.replace(/([0-9A-z\-\s]+[樓層]|[0-9A-z號\-\s]+[舖鋪]|地[下庫]|平台).*/g,"");return t}function a(e,t){for(const r in s)if(r===e)return t?s[r].chi:s[r].eng;return t?s.invalid.chi:s.invalid.eng}function i(e,t){const r={};for(const s of Object.keys(e)){let n=e[s];if("object"===typeof n)Object.assign(r,i(n,t));else if("string"===typeof n)if(t&&("StreetName"===s||"VillageName"===s||"EstateName"===s)&&n.indexOf(" ")>=0){const e=n.split(" ");for(let t=0;t<e.length;t++)r[s+(t+1)]=e[t]}else"DcDistrict"===s&&(n=a(n,t)),r[s]=n}return r}function o(e){return e.SuggestedAddress.map(e=>({chi:i(e.Address.PremisesAddress.ChiPremisesAddress,!0),eng:i(e.Address.PremisesAddress.EngPremisesAddress,!1),geo:i(e.Address.PremisesAddress.GeospatialInformation,!1)}))}function l(e,t){const r=t.chi;for(const s of Object.keys(r))if(e===r[s])return{key:s,val:r[s]};return null}function c(e,t){const r=[];let s=0,n=0;while(s<e.length){let a;n=e.length;while(s<n){a=e.substring(s,n);const i=l(a,t);if(null!==i){r.push(i);break}n-=1}n===s&&(r.length>0&&r[r.length-1].key,r.push({key:"?",val:e.substring(s,e.length)})),s+=a.length}return r}function u(e,t){return e.indexOf(t)>=0}function d(e,t){for(const r of t){const t=c(e,r),s={level:-1,charlen:0},n=[];for(const{key:e,val:r}of t)u(e,"StreetName")?(s.level=1,s.charlen+=r.length,n.push("StreetName")):u(e,"BuildingNoFrom")&&1===s.level?(s.level=3,s.charlen+=r.length,n.push("BuildingNoFrom")):u(e,"BuildingName")||u(e,"VillageName")||u(e,"EstateName")?(s.charlen+=r.length,-1===s.level&&(s.level=2),n.push(e.replace(/\d+$/g,""))):u(e,"BlockDescriptor")&&(s.charlen+=r.length,n.push("BlockDescriptor"));r.score=s,r.matches=n}return t=t.sort((e,t)=>{const r=e.score.level!==t.score.level?t.score.level-e.score.level:t.score.charlen-e.score.charlen;return r}),t.slice(0,200)}async function h(e,t){const r=n(e),s=o(t);return d(r,s)}e.exports={searchResult:h}},c991:function(e,t,r){},c9d9:function(e,t){const r={invalid:{eng:"Invalid District Name",chi:"無效地區"},CW:{eng:"Central and Western District",chi:"中西區"},EST:{eng:"Eastern District",chi:"東區"},ILD:{eng:"Islands District",chi:"離島區"},KLC:{eng:"Kowloon City District",chi:"九龍城區"},KC:{eng:"Kwai Tsing District",chi:"葵青區"},KT:{eng:"Kwun Tong District",chi:"觀塘區"},NTH:{eng:"North District",chi:"北區"},SK:{eng:"Sai Kung District",chi:"西貢區"},ST:{eng:"Sha Tin Distric",chi:"沙田區"},SSP:{eng:"Sham Shui Po District",chi:"深水埗區"},STH:{eng:"Southern District",chi:"南區"},TP:{eng:"Tai Po District",chi:"大埔區"},TW:{eng:"Tsuen Wan District",chi:"荃灣區"},TM:{eng:"Tuen Mun District",chi:"屯門區"},WC:{eng:"Wan Chai District",chi:"灣仔區"},WTS:{eng:"Wong Tai Sin District",chi:"黃大仙區"},YTM:{eng:"Yau Tsim Mong District",chi:"油尖旺區"},YL:{eng:"Yuen Long District",chi:"元朗區"}};e.exports={dcDistrict:r}},f344:function(e,t,r){"use strict";var s=r("c991"),n=r.n(s);n.a},f8bd:function(e,t,r){"use strict";var s=r("3593"),n=r.n(s);n.a}});
//# sourceMappingURL=app.9918b81b.js.map